# Тесты для NodeSerialStream Server

Этот каталог содержит полный набор тестов для сервера NodeSerialStream.

## Структура тестов

```
tests/
├── setup.js                    # Настройка тестовой среды
├── controllers/                # Тесты контроллеров
│   ├── userController.test.js  # Тесты для управления пользователями
│   └── standController.test.js # Тесты для управления стендами
├── routes/                     # Тесты роутов
│   ├── userRouter.test.js      # Тесты API роутов пользователей
│   └── standRouter.test.js     # Тесты API роутов стендов
├── models/                     # Тесты моделей
│   └── userModel.test.js       # Тесты модели User
├── middleware/                 # Тесты middleware
│   ├── serial.test.js          # Тесты serial middleware
│   └── socketManager.test.js   # Тесты socket manager
└── integration/                # Интеграционные тесты
    └── server.test.js          # Полные интеграционные тесты
```

## Запуск тестов

### Установка зависимостей
```bash
npm install
```

### Запуск всех тестов
```bash
npm test
```

### Запуск тестов в режиме наблюдения
```bash
npm run test:watch
```

### Запуск тестов с покрытием кода
```bash
npm run test:coverage
```

## Покрытие тестами

Тесты покрывают следующие области:

### Контроллеры
- **userController**: Создание, получение, обновление, удаление пользователей
- **standController**: Управление состоянием стендов, проверка тестов

### Роуты
- **userRouter**: Все HTTP эндпоинты для пользователей
- **standRouter**: Все HTTP эндпоинты для стендов

### Модели
- **User**: Валидация схемы, операции с массивами, ограничения

### Middleware
- **serial**: Функции работы с последовательными портами
- **socketManager**: Функции управления WebSocket соединениями

### Интеграционные тесты
- Полные пользовательские сценарии
- Обработка ошибок
- Консистентность данных

## Тестовая среда

- **Jest**: Основной фреймворк для тестирования
- **Supertest**: Тестирование HTTP API
- **MongoDB Memory Server**: Изолированная тестовая база данных
- **Моки**: Для внешних зависимостей (axios, логирование)

## Особенности тестирования

1. **Изоляция**: Каждый тест выполняется в изолированной среде
2. **Очистка данных**: База данных очищается после каждого теста
3. **Моки**: Внешние зависимости замокированы для стабильности
4. **Валидация**: Проверка всех сценариев успеха и ошибок
5. **Интеграция**: Полные пользовательские сценарии

## Добавление новых тестов

При добавлении нового функционала:

1. Создайте unit тесты для новых функций
2. Добавьте интеграционные тесты для новых API
3. Обновите моки при необходимости
4. Убедитесь, что покрытие кода остается высоким

## Отладка тестов

Для отладки конкретного теста:
```bash
npm test -- --testNamePattern="название теста"
```

Для отладки конкретного файла:
```bash
npm test -- tests/controllers/userController.test.js
```